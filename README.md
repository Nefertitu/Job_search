# Job Search Parser

Проект для поиска и анализа вакансий с HeadHunter API с возможностью фильтрации и сортировки.

## Структура проекта
```
.
├── Job_search/
│   ├── data/                # Данные, используемые проектом(JSON-файлы с вакансиями, лог-файл)
│   └── src/                 # Исходный код проекта
│       ├── __init__.py      # Файл инициализации пакета
│       ├── base_file_handler.py   # Базовый класс для обработчика файлов
│       ├── external_api.py          # Работа с внешними API c курсами валют
│       ├── head_hunter_api.py       # Класс для работы с API HeadHunter (hh.ru)
│       ├── json_handler.py           # Класс для работы с JSON-файлами
│       ├── parser_api.py             # Общий класс для парсера API
│       ├── utils.py                  # Вспомогательные функции
│       └── vacancy.py                # Класс работы с вакансиями
├── tests/                    # Тесты для проекта
│   ├── __init__.py           # Файл инициализации тестов
│   ├── conftest.py           # Фикстуры
│   ├── test_external_api.py  # Тесты для внешнего API
│   ├── test_head_hunter_api.py     # Тесты для API HeadHunter
│   ├── test_json_handler.py        # Тесты для обработки JSON
│   ├── test_utils.py               # Тесты для вспомогательных функций
│   └── test_vacancy.py             # Тесты для класса вакансии
├── .gitignore                 # Игнорируемые файлы для Git
├── LICENSE.txt                # Лицензия MIT
├── main.py                    # Главный файл запуска приложения
├── poetry.lock                # Фиксированные версии зависимостей Poetry
├── pyproject.toml             # Настройки проекта для Poetry
└── README.md                  # Описание проекта
```

## Функциональность

### Классы:

1. `Class BaseFileHandler (ABC)`: Абстрактный базовый класс для работы с файлами. 
Определяет абстрактные методы `add_vacancy()` и `delete_vacancy()`.

2. `Class JsonHandler`: Класс, реализующий `BaseFileHandler` для работы с JSON-файлами.  
Включает методы для добавления, удаления и получения данных из JSON-файла.  
Поддерживает контекстный менеджмент (`__enter__()`, `__exit__()`).

3. `Class ParserAPI (ABC)`: Абстрактный базовый класс для работы с API сайтов. 
Определяет абстрактный метод `load_vacancies()`.

4. `Class HeadHunterAPI`: Класс, реализующий `Class ParserAPI` для работы с API HeadHunter. 
Предоставляет метод для загрузки вакансий (`load_vacancies()`), а также свойства для доступа к 
URL(`__get_connect()`), заголовкам и параметрам запроса.

5. `Class Vacancy`: Класс для работы с вакансиями. Экземпляр класса содержит данные о 
вакансии(ID, название, компания, зарплата и т.д.), метод валидации загруженных данных о 
вакансиях `__validate_data()`, методы для сравнения вакансий по зарплате.


### Функции:

- `get_external_rate()`: Получает текущий курс валюты с сайта ЦБ РФ.

- `filter_vacancies()`: Фильтрует список вакансий по ключевым словам (содержащим их или нет).

- `sort_vacancies()`: Сортирует список вакансий по заработной плате в порядке убывания.

- `get_top_vacancies()`: Выбирает топ N вакансий.

- `user_interaction()`: Обеспечивает взаимодействие с пользователем для ввода параметров 
поиска и сохранения данных  по вакансиям. Основная функци для взаимодействия с пользователем.

- `get_filename_path()`: Генерирует путь к файлу с именем, включающим текущую дату.

- `write_copy_file()`: Создает резервную копию JSON-файла.


## Установка

1. Клонируйте репозиторий:
```
git clone git@github.com:Nefertitu/Job_search.git
```
2. Установите зависимости:
```
poetry install
```

## Использование

Запустите скрипт `main.py`.  Программа запросит у пользователя необходимые параметры поиска
и сохранит результаты в JSON-файл. Создается резервная копия файла. Осуществляется логирование
информации о работе функций и методов проекта (файл - `/data/logging_reports.log`).


## Тестирование

Проект включает юнит-тесты pytest.

Для запуска тестов выполните команду:
- при активированном виртуальном окружении:
```
pytest --cov
 
```
*Текущие результаты тестирования:*
```
_________ coverage: platform win32, python 3.13.1-final-0 ________________ 

Name                            Stmts   Miss  Cover
---------------------------------------------------
src\__init__.py                     0      0   100%
src\base_file_handler.py           12      2    83%
src\external_api.py                 9      0   100%
src\head_hunter_api.py             76      4    95%
src\json_handler.py                81      3    96%
src\parser_api.py                   8      1    88%
src\utils.py                      128     44    66%
src\vacancy.py                     95      4    96%
tests\__init__.py                   0      0   100%
tests\conftest.py                  37      0   100%
tests\test_external_api.py         12      0   100%
tests\test_head_hunter_api.py      77      2    97%
tests\test_json_handler.py        152      6    96%
tests\test_utils.py                64      0   100%
tests\test_vacancy.py             145     12    92%
---------------------------------------------------
TOTAL                             896     78    91%
======================================= 42 passed in 0.50s ==============
```

## Примеры работы основных функций:

1. Пример создания экземпляра класса `Vacancy`:
```
Vacancy(
        id='2222222', 
        name='Junior, backend разработчик', 
        area='Санкт-Петербург', 
        employer='Test_3', 
        url='https://example_url.com', 
        salary='от 80000 до 120000 RUR', 
        requirements='Знание <Python>', 
        status='Открытая', 
        published_at='2025-02-20T17:52:03+0300', 
        employment_form='Полная', 
        experience='От 1 года до 3 лет'
        )
```

2. Пример работы `main.py`:
```
Введите данные для выполнения поискового запроса о вакансиях на платформе ['HeadHunter']: Python

Выполняется запрос к API сайта hh.ru...

Произведена запись полученных данных в файл 'vacancies_save.json'.

Введите ключевое слово (или список слов) для фильтрации вакансий
(пример: Москва, Junior): Петербург

Введите диапазон зарплат (пример: 100000 - 150000): 100000 - 300000

Записать отфильтрованные данные по вакансиям в файл 'vacancies_save.json'? (Введите: да/нет): да

Выполняется запись данных в файл...

Общее количество вакансий, полученных после фильтрации, составляет 14 шт.

Введите количество вакансий для вывода в топ N: 1

            Наименование вакансии - Python-разработчик,
            месторасположение - Санкт-Петербург,
            работодатель - ТМХ ТМ,
            url-адрес вакансии на сайте hh.ru - https://hh.ru/vacancy/119293385,
            заработная плата - от 100000 до 200000 RUR,
            требования - Опыт работы от 1 до 3 лет в области разработки на Python. Глубокие знания Python, FastAPI и PostgreSQL. ,
            статус вакансии - Открытая,
            дата публикации вакансии - 2025-04-08T15:49:44+0300,
            форма трудоустройства - Полная,
            опыт работы - От 1 года до 3 лет


```
3. Пример записи данных о вакансиях в JSON-файл (`data/vacancies_save.json`):
```
[
    {
        "1191*****": {
            "name": "Тестировщик QA",
            "area": "Санкт-Петербург",
            "employer": "Example name",
            "url": "https://hh.ru/vacancy/1191*****",
            "salary": "от 130000 до 170000 RUR",
            "requirement": "Умение разрабатывать тестовую документацию... Знание языков программирования (Python).",
            "status": "Открытая",
            "published_at": "2025-04-08T12:07:44+0300",
            "employment_form": "Полная",
            "experience": "От 1 года до 3 лет"
        }
    },
```

4. Пример записи логов в лог-файл (`data/logging_reports.log`):
```
INFO | 2025-04-10 01:37:36,336 | Попытка чтения файла - файл для записи вакансий пуст.
Соединение с API сайта: 'https://api.hh.ru/' установлено успешно.
INFO | 2025-04-10 01:37:26,262 | Получен список вакансий по ключевому слову: 'Python'.
INFO | 2025-04-10 01:37:36,335 | Получены вакансии по ключевому слову: Python в количестве 200 шт.
INFO | 2025-04-10 01:37:50,319 | Произведена фильтрация полученных вакансий по ключевому 
слову (словам): 'Петербург', количество полученных вакансий составило: 22 шт.
INFO | 2025-04-10 01:37:57,180 | Вакансии отфильтрованы по установленному размеру заработной 
платы (100000 - 300000), количество полученных вакансий: 14 шт.
INFO | 2025-04-10 01:38:07,180 | Получен список топ-1 вакансий.
INFO | 2025-04-10 01:38:07,181 | Вывод данных в консоль:

INFO | 2025-04-10 01:38:07,181 | Получена вакансия: 
            Наименование вакансии - Python-разработчик,
            месторасположение - Санкт-Петербург,
            работодатель - Example name,
            url-адрес вакансии на сайте hh.ru - https://hh.ru/vacancy/1192*****,
            заработная плата - от 100000 до 200000 RUR,
            требования - Опыт работы от 1 до 3 лет в области разработки на Python. Глубокие знания Python, FastAPI и PostgreSQL. ,
            статус вакансии - Открытая,
            дата публикации вакансии - 2025-04-08T15:49:44+0300,
            форма трудоустройства - Полная,
            опыт работы - От 1 года до 3 лет

INFO | 2025-04-10 01:38:07,197 | Выполнена запись копии данных по вакансиям в файл: 'logging_reports.log'

```

## Лицензия

Этот проект лицензирован по [лицензии MIT](LICENSE.txt).